overrides:
  ceph-deploy:
    prepare_activate: true
    conf:
      client:
        log file: /var/log/ceph/ceph-$name.$pid.log
      mon:
        debug mon: 1
        debug ms: 20
        debug paxos: 20
      osd:
        debug filestore: 20
        debug journal: 20
        debug ms: 1
        debug osd: 20
      global:
        mon pg warn min per osd: 2
        osd pool default size: 2
        osd pool default pg num:  1024
        osd pool default pgp num:  1024
roles:
- - mon.a
  - mon.b
  - mon.c
  - osd.0
  - osd.1
- - osd.2
  - osd.3
- - client.0
tasks:
- ssh-keys:
- ceph-deploy:
    rhbuild: '1.3.2' 
    fs: xfs
- radosbench:
      clients: [client.0]
      time: 600
      size: 1
      cleanup: false
- exec:
    mon.a:
    - sudo ceph osd set noout
- ceph-deploy.upgrade:
    latest: true
    roles:
      - mon.a
      - osd.2
      - client.0
- exec:
    mon.a:
    - sudo ceph osd set sortbitwise 
- parallel:
  - radosbench2
  - setsortbitwise
radosbench2:
  sequential:
  - radosbench:
      clients: [client.0]
      time: 600
      size: 1
sortbitwise:
  sequential:
  - exec:
      client.0:
      - sleep 10
      - ceph osd set sortbitwise